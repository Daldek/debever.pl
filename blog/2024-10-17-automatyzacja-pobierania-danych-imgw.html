<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Historia prób stworzenia narzędzia Python do automatyzacji pobierania publicznych danych z IMGW i napotkanych przy tym wyzwań.">
  <meta name="author" content="Piotr de Bever">

  <!-- Open Graph -->
  <meta property="og:title" content="O tym jak próbowałem zautomatyzować pobieranie danych z IMGW | Piotr de Bever">
  <meta property="og:description" content="Historia prób stworzenia narzędzia Python do automatyzacji pobierania publicznych danych z IMGW i napotkanych przy tym wyzwań.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://debever.pl/blog/2024-10-17-automatyzacja-pobierania-danych-imgw.html">
  <meta property="og:locale" content="pl_PL">
  <meta property="og:site_name" content="Piotr de Bever">
  <meta property="article:published_time" content="2024-10-17">
  <meta property="article:author" content="Piotr de Bever">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="O tym jak próbowałem zautomatyzować pobieranie danych z IMGW">
  <meta name="twitter:description" content="Historia prób stworzenia narzędzia Python do automatyzacji pobierania publicznych danych z IMGW i napotkanych przy tym wyzwań.">

  <title>O tym jak próbowałem zautomatyzować pobieranie danych z IMGW | Piotr de Bever</title>
  <link rel="canonical" href="https://debever.pl/blog/2024-10-17-automatyzacja-pobierania-danych-imgw.html">

  <!-- Favicon -->
  <link rel="icon" href="/assets/images/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
  <meta name="theme-color" content="#0d1117">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Blog Piotra de Bevera" href="/blog/feed.xml">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "O tym jak próbowałem zautomatyzować pobieranie danych z IMGW",
    "description": "Historia prób stworzenia narzędzia Python do automatyzacji pobierania publicznych danych z IMGW i napotkanych przy tym wyzwań.",
    "datePublished": "2024-10-17",
    "author": {
      "@type": "Person",
      "name": "Piotr de Bever",
      "url": "https://debever.pl/"
    },
    "publisher": {
      "@type": "Person",
      "name": "Piotr de Bever"
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://debever.pl/blog/2024-10-17-automatyzacja-pobierania-danych-imgw.html"
    }
  }
  </script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <a href="/" class="logo">Piotr de Bever</a>
      <nav class="nav">
        <button class="nav__toggle" aria-label="Menu" aria-expanded="false">
          <span class="nav__hamburger"></span>
        </button>
        <ul class="nav__list">
          <li><a href="/#uslugi" class="nav__link">Usługi</a></li>
          <li><a href="/#portfolio" class="nav__link">Portfolio</a></li>
          <li><a href="/#o-mnie" class="nav__link">O mnie</a></li>
          <li><a href="/#kontakt" class="nav__link">Kontakt</a></li>
          <li><a href="/blog/" class="nav__link nav__link--active">Blog</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <article class="blog-post">
      <div class="container">
        <!-- Post Header -->
        <header class="blog-post__header">
          <div class="blog-post__meta">
            <time datetime="2024-10-17">17 października 2024</time>
            <span class="blog-post__category">Programming</span>
          </div>
          <h1 class="blog-post__title">O tym jak próbowałem zautomatyzować pobieranie danych z IMGW</h1>
          <div class="blog-post__tags"><a href="/blog/tag/api.html" class="blog-post__tag">api</a>, <a href="/blog/tag/hydrology.html" class="blog-post__tag">hydrology</a>, <a href="/blog/tag/imgw.html" class="blog-post__tag">imgw</a>, <a href="/blog/tag/meteorology.html" class="blog-post__tag">meteorology</a>, <a href="/blog/tag/opendata.html" class="blog-post__tag">opendata</a>, <a href="/blog/tag/python.html" class="blog-post__tag">python</a></div>
        </header>

        <!-- Post Content -->
        <div class="blog-post__content">
          <h2>Dane publiczne IMGW</h2>
<p>We wrześniu 2023, w ramach nauki Pythona, zacząłem pracę nad projektem, upraszczającym <strong>pobieranie danych publicznych IMGW</strong> z serwisu <a href="https://danepubliczne.imgw.pl/">https://danepubliczne.imgw.pl/</a>. Zadanie wydawałoby się proste, bo czym jest połączenie się z <strong>API,</strong> pobranie danych i zapisanie ich do pliku? Jak się okazało, rzeczywistość był bardziej złożona. Aż chce się zacytować Boromira, <em>“One does not simply walk into Mordor”</em>.</p>
<p>Repozytorium mojego projektu znajdziecie na GitHubie: <a href="https://github.com/Daldek/IMGWTools" target="_blank" rel="noopener">https://github.com/Daldek/IMGWTools</a></p>
<h3>API</h3>
<p>Większość serwisów, z których korzystałem udostępnia dane przez API. Najczęściej wystarczy zdefiniować kilka podstawowych parametrów, przesłać zapytanie do serwera i <em>et voilà</em>, dostajemy to o co prosiliśmy. Niestety, <strong>IMGW</strong> ograniczyło tę możliwość wyłącznie do pobierania aktualnych pomiarów, bez dostępu do danych historycznych.</p>
<p>Żeby nie było tak łatwo, na niczego nieświadomych użytkowników zastawiono kilka pułapek. Chcecie pobrać <strong>dane synoptyczne</strong>? Nie ma problemu! Podajcie tylko nazwę stacji lub jej identyfikator i dostaniecie najświeższe informacje. Chcecie tak samo pobrać <strong>dane hydrologiczne</strong> lub <strong>meteorologiczne</strong>? Wstrzymajcie swoje konie, bo od teraz akceptujemy tylko identyfikator.</p>
<p>Jeżeli myślicie, że łatwiej będzie z analizą odpowiedzi otrzymanej z serwera, to jesteście w błędzie. Część danych jest zwracana jako słownik, część jako jednoelementowa lista zawierająca słownik. Może chociaż format przekazywanych danych będzie wspólny? W HTMLu nie przekażemy wam danych w najnowszej wersji API dla hydro. Dlaczego? Bo nie.</p>
<p><strong>Niestety, ten brak konsekwencji jest tylko zapowiedzią tego co nas czeka za chwilę.</strong></p>
<h3>Dane plikowe</h3>
<p>Wszystkie dane historyczne są przekazywane jako pliki csv (właściwie to zip z csv w środku). IMGW podzieliło je, podobnie jak te dostępne przez API, na 3 kategorie:</p>
<ol>
<li>Dane aktynometryczne.</li>
<li>Dane hydrologiczne.</li>
<li>Dane meteorologiczne.</li>
</ol>
<p>Poza tym, na stronie znajdziemy jeszcze kilka innych folderów, z biuletynem PSHM, rocznikami oraz, najciekawszy, “test”.</p>
<h4>Dane hydrologiczne</h4>
<p>Przeanalizujmy to co jest dla mnie najciekawsze, czyli sposób w jaki IMGW udostępnia nam <strong>dane hydrologiczne</strong>.</p>
<p><strong>Dane hydrologiczne</strong> są dostępne w podziale na <strong>dobowe</strong>, <strong>miesięczne</strong> oraz połączone<strong> półroczne i roczne</strong> pliki. Znajdziemy w nich zakres od 1951 roku do 2023. Do 2022 roku pliki są dość jednolite — nazewnictwo zaczyna się od skrótu interwału, np. “codz”, a następnie rok i miesiąc lub zmienna (jeżeli dotyczy). Co z 2023? Z nazwy wyrzucono numer miesiąca, więc misternie napisany w Pythonie kod, trzeba dostosować do tej drobnej, acz istotnej zmiany.</p>
<p>A w środku? Eh, źle się dzieje <del>w państwie duńskim</del>. Festiwal niekonsekwencji, ponieważ niektóre kolumny mają informacje zapisane jako ciągi znaków, czyli coś co Python mógłby zinterpretować jako tekst. Zapisywanie identyfikatora lub roku raczej tego nie wymaga, nie? Inne dane są już dobrych typów, czyli int lub float. A co, jeżeli nie ma obserwacji? Tutaj możemy się spodziewać braku wpisu w kolumnie, wartości 99.9, albo 9999 ewentualnie 99999.999, co oczywiście zostało wyczerpująco opisane w osobnym pliku. Do tego jeszcze dodajmy spacje poprzedzające identyfikatory stacji. Rok 2023 prezentuje się lepiej, ale za to zmieniono separator kolumn z przecinka na średnik. Kolejna pętla “if-elif-else” ląduje w kodzie.</p>
<p><a href="/blog/assets/images/2024-10-Dane-publiczne-hydro-imgw.png"><img fetchpriority="high" decoding="async" class="alignnone wp-image-657 size-large" src="/blog/assets/images/2024-10-Dane-publiczne-hydro-imgw-1024x172.png" alt="" width="1024" height="172" srcset="/blog/assets/images/2024-10-Dane-publiczne-hydro-imgw-1024x172.png 1024w, /blog/assets/images/2024-10-Dane-publiczne-hydro-imgw-300x50.png 300w, /blog/assets/images/2024-10-Dane-publiczne-hydro-imgw-768x129.png 768w, /blog/assets/images/2024-10-Dane-publiczne-hydro-imgw-1536x257.png 1536w, /blog/assets/images/2024-10-Dane-publiczne-hydro-imgw.png 1593w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>Warto jeszcze wspomnieć o tym, że pliki dzienne i miesięczne zawierają wszystkie 3 mierzone parametry, czyli <strong>przepływ</strong>, <strong>stan wody</strong> oraz jej <strong>temperaturę</strong>. Pliki półroczne i roczne są podzielone na kolejne 3 kategorie, żeby nie łączyć ze sobą wszystkich parametrów. Jeżeli dobrze się im przyjrzycie, to zobaczycie, że w 2023 brakuje jednej kolumny.</p>
<h4>Dane meteorologiczne</h4>
<p>Jeżeli w danych hydro źle się działo, to tutaj jest obraz nędzy i rozpaczy. Na pierwszy widzimy, że dane dodatkowo podzielono na klimatologiczne, opadowe i synoptyczne. Po wejściu głębiej, okazuje się, że część plików pogrupowano w wielolecia. Konwencja nazewnictwa plików wydaje się być podobna do tej znanej z hydro, ale to tylko pozory. W przypadku plików “zip” wydawałoby się, mamy jasną sytuację. Nazwa zaczyna się od roku, następnie jest… miesiąc? Czasem tak, czasem jest oznaczenie typu danych. To samo oznaczenie może znajdować się równie dobrze na 3. miejscu, ale z tym też bywa różnie, bo może się tam znajdować oznaczanie rodzaju stacji. W danych synoptycznych, “drugie miejsce” jest, wydawałoby się, losową wartość liczbową, która na pewno ma jakieś znacznie, którego ja po prostu jeszcze nie odkryłem.</p>
<p>Niestety, ale skutecznie uniemożliwiło mi to zautomatyzowanie pobierania tych danych. Zresztą, po rozpakowaniu zawartość tych zipów też zmienia sposób nazywania plików. To nam daje 2 osobne funkcje, które złożą nam nazwę pliku w całość.</p>
<p><strong>Zgubiliście się w tym opisie? Bardzo dobrze, bo ja też.</strong></p>
<h3>Co robić i jak żyć?</h3>
<p>Projekt rozwijam od ponad roku z przerwą, aż tegoroczna powódź w dorzeczu Odry zmotywowała mnie do jego kontynuacji. W tym czasie zacząłem również <strong>studia podyplomowe z hydrologii na URK</strong>, co dostarcza dodatkowej motywacji do kontynuowania prac.</p>
<p><a href="/blog/assets/images/2024-10-Notatki-scaled.jpg"><img decoding="async" class="alignnone size-medium wp-image-659" src="/blog/assets/images/2024-10-Notatki-300x225.jpg" alt="" width="300" height="225" srcset="/blog/assets/images/2024-10-Notatki-300x225.jpg 300w, /blog/assets/images/2024-10-Notatki-1024x768.jpg 1024w, /blog/assets/images/2024-10-Notatki-768x576.jpg 768w, /blog/assets/images/2024-10-Notatki-1536x1152.jpg 1536w, /blog/assets/images/2024-10-Notatki-2048x1536.jpg 2048w" sizes="(max-width: 300px) 100vw, 300px"></a></p>
<p>Pomimo problemów udało mi się rozwiązać większość z nich, choć największym wyzwaniem pozostają dane meteo. Mam nadzieję, że IMGW kiedyś zorganizuje je w bardziej przejrzysty sposób — to byłoby prawdziwym wybawieniem dla wszystkich użytkowników.</p>
<p>Osobną kwestią jest też ich wiarygodność, tzn. na ile są one oczyszczone z błędów i czy nadają się one do wykorzystania w projektach. Z tego co słyszałem to odpowiedź brzmi “<strong>nie</strong>“, ponieważ “dane są największym skarbem instytutu” jak to rzekomo miał stwierdzić pewien profesor.</p>
        </div>

        <!-- Post Navigation -->
        <nav class="blog-nav" aria-label="Nawigacja między wpisami">
          <a href="2024-10-07-wprowadzenie-do-gis.html" class="blog-nav__link blog-nav__link--prev">&larr; Wprowadzenie do GIS</a>
          <a href="2025-03-20-transfer-plikow-w-sieci-domowej.html" class="blog-nav__link blog-nav__link--next">Transfer plików w sieci domowej &rarr;</a>
        </nav>

        <!-- Back to Blog -->
        <div class="blog-post__back">
          <a href="/blog/" class="btn btn--secondary">&larr; Wszystkie wpisy</a>
        </div>
      </div>
    </article>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 Piotr de Bever. Wszelkie prawa zastrzeżone.</p>
      <nav class="footer__nav">
        <a href="/">Strona główna</a>
      </nav>
    </div>
  </footer>

  <script src="/assets/js/main.js"></script>
</body>
</html>
